<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}KB Admin{% endblock %}</title>

    <!-- Design System CSS -->
    <link rel="stylesheet" href="/static/admin/css/tokens.css">
    <link rel="stylesheet" href="/static/admin/css/components.css">

    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.12"></script>

    <!-- Layout-specific styles -->
    <style>
        /* Container */
        .container {
            max-width: var(--container-max-width);
            margin: 0 auto;
            padding: var(--space-5);
        }

        /* Navigation */
        nav {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            padding: var(--space-3) var(--space-5);
            margin-bottom: var(--space-5);
        }

        nav .nav-content {
            max-width: var(--container-max-width);
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: var(--space-6);
        }

        nav .nav-links {
            display: flex;
            align-items: center;
            gap: var(--space-6);
            flex: 1;
        }

        nav .nav-right {
            display: flex;
            align-items: center;
            gap: var(--space-4);
            margin-left: auto;
        }

        nav .logout-btn {
            color: var(--text-muted);
            font-size: 13px;
            padding: var(--space-2) var(--space-3);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
            transition: all var(--transition-base);
        }

        nav .logout-btn:hover {
            color: var(--danger);
            border-color: var(--danger);
            text-decoration: none;
        }

        nav .logo {
            font-weight: var(--font-weight-semibold);
            font-size: var(--font-size-xl);
            color: var(--text);
            text-decoration: none;
        }

        nav a {
            color: var(--text-muted);
            text-decoration: none;
            font-size: var(--font-size-base);
        }

        nav a:hover, nav a.active {
            color: var(--text);
        }

        /* Compare Tray */
        #compare-tray {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border);
            padding: var(--space-3) var(--space-5);
            display: flex;
            align-items: center;
            gap: var(--space-4);
            z-index: var(--z-modal);
            transition: transform var(--transition-base);
        }

        #compare-tray.tray-hidden {
            transform: translateY(100%);
        }

        #compare-tray.tray-collapsed .tray-chips,
        #compare-tray.tray-collapsed .tray-actions {
            display: none;
        }

        .tray-left {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }

        .tray-label {
            font-size: var(--font-size-base);
            color: var(--text-muted);
            white-space: nowrap;
        }

        .tray-count {
            background: var(--info);
            color: #fff;
            padding: 2px var(--space-2);
            border-radius: var(--radius-full);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
            min-width: 20px;
            text-align: center;
        }

        .tray-chips {
            display: flex;
            gap: var(--space-2);
            flex-wrap: wrap;
            flex: 1;
            min-width: 0;
        }

        .tray-chip {
            background: var(--bg);
            border: 1px solid var(--border);
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-sm);
            font-size: var(--font-size-sm);
            font-family: var(--font-mono);
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
        }

        .chip-remove {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: var(--font-size-base);
            line-height: 1;
            padding: 0;
        }

        .chip-remove:hover {
            color: var(--danger);
        }

        .tray-more {
            font-size: var(--font-size-sm);
            color: var(--text-muted);
            font-style: italic;
        }

        .tray-actions {
            display: flex;
            gap: var(--space-2);
            margin-left: auto;
        }

        .tray-btn {
            padding: var(--space-2) var(--space-3);
            font-size: 13px;
            border-radius: var(--radius-md);
            cursor: pointer;
            border: none;
            font-weight: var(--font-weight-medium);
        }

        .tray-btn-compare {
            background: var(--info);
            color: #fff;
        }

        .tray-btn-compare:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .tray-btn-clear {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text);
        }

        .tray-btn-clear:hover {
            background: var(--bg);
        }

        .tray-collapse {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: var(--font-size-lg);
            padding: var(--space-1);
        }

        .tray-collapse:hover {
            color: var(--text);
        }

        .tray-shake {
            animation: shake 0.3s ease;
        }

        /* Add padding to container when tray is visible */
        body:has(#compare-tray:not(.tray-hidden)) .container {
            padding-bottom: 70px;
        }
    </style>
    {% block head_extra %}{% endblock %}
</head>
<body>
    <nav>
        <div class="nav-content">
            <a href="/" class="logo">Trading RAG</a>
            <div class="nav-links">
                <a href="/admin/ingest" {% if request.url.path.startswith('/admin/ingest') %}class="active"{% endif %}>Ingest</a>
                <a href="/admin/kb/entities" {% if request.url.path.startswith('/admin/kb/entities') %}class="active"{% endif %}>Entities</a>
                <a href="/admin/kb/claims" {% if request.url.path == '/admin/kb/claims' %}class="active"{% endif %}>Claims</a>
                <a href="/admin/coverage/cockpit" {% if request.url.path.startswith('/admin/coverage') %}class="active"{% endif %}>Coverage</a>
                <a href="/admin/backtests/tunes" {% if request.url.path.startswith('/admin/backtests/tunes') or request.url.path.startswith('/admin/backtests/wfo') or request.url.path.startswith('/admin/backtests/leaderboard') %}class="active"{% endif %}>Tunes</a>
                <a href="/admin/backtests/strategy-test" {% if request.url.path.startswith('/admin/backtests/strategy-test') %}class="active"{% endif %}>Backtest</a>
                <a href="/admin/testing/run-plans" {% if request.url.path.startswith('/admin/testing') %}class="active"{% endif %}>Run Plans</a>
                <a href="/admin/trade/events" {% if request.url.path.startswith('/admin/trade') %}class="active"{% endif %}>Events</a>
                <a href="/admin/alerts/page?workspace_id=00000000-0000-0000-0000-000000000001" {% if request.url.path.startswith('/admin/alerts') %}class="active"{% endif %}>Alerts</a>
                <a href="/admin/analytics/regimes?workspace_id=00000000-0000-0000-0000-000000000001" {% if request.url.path.startswith('/admin/analytics') %}class="active"{% endif %}>Analytics</a>
            </div>
            <div class="nav-right">
                <a href="/docs" title="API Documentation">Docs</a>
                <a href="/admin/auth/logout" class="logout-btn">Logout</a>
            </div>
        </div>
    </nav>

    <div class="container">
        {% block content %}{% endblock %}
    </div>

    <!-- Compare Tray (global) -->
    <div id="compare-tray" class="tray-hidden">
        <div class="tray-left">
            <button class="tray-collapse" title="Toggle tray">&#9660;</button>
            <span class="tray-label">Selected: <span class="tray-count">0</span></span>
        </div>
        <div class="tray-chips"></div>
        <div class="tray-actions">
            <button class="tray-btn tray-btn-compare" disabled>Compare</button>
            <button class="tray-btn tray-btn-clear">Clear</button>
        </div>
    </div>

    <!-- Global scripts -->
    <script src="/static/admin/js/compare_tray.js"></script>

    {% block scripts %}{% endblock %}
</body>
</html>
